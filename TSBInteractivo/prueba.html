<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>That's Showbiz Baby!</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  display: flex;
  justify-content: center; 
  align-items: center;    
  background: #f0f0f0;
  font-family: sans-serif;
  overflow: hidden;
}

#album-container {
  position: relative;
  width: 90%;
  max-width: 1400px;
  height: auto;
  margin-top: -50px; 
}

#background {
  width: 100%;
  height: auto;
  display: block;
  user-select: none;   
  pointer-events: none; 
}

#sticker-bar {
  position: absolute;
  bottom: -140px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
}

#sticker-bar img {
  max-height: 80px;
  width: auto;
  cursor: grab;
}

.sticker-wrapper {
  position: absolute;
  display: inline-block;
  cursor: grab;
  user-select: none;
}

.sticker-wrapper img {
  display: block;
}

.resize-handle {
  width: 15px;
  height: 15px;
  background: #37539c;
  position: absolute;
  bottom: 0;
  right: 0;
  cursor: se-resize;
}

#reset-btn {
  position: absolute;
  top: -50px;
  right: 0;
  padding: 8px 12px;
  background: #37539c;
  color: white;
  border: none;
  border-radius: 0px;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="album-container">
  <img id="background" src="images/JADE_BLANK_INSIDE.png" alt="Álbum abierto">

  <div id="sticker-bar">
    <img src="images/angel.png">
    <img src="images/fav.png">
    <img src="images/jade-1 (1).png">
    <img src="images/jade-2.png">
    <img src="images/jade-3.png">
    <img src="images/jade-4.png">
    <img src="images/jade-5.png">
    <img src="images/jade-6.png">
    <img src="images/jade-7.png">
    <img src="images/jade-8.png">
    <img src="images/jade-14.png">
    <img src="images/jade-9.png">
    <img src="images/jade-10.png">
    <img src="images/jade-11.png">
    <img src="images/jade-12.png">
    <img src="images/jade-13.png">
  </div>

  <button id="reset-btn">RESET</button>
</div>

<script>
const albumContainer = document.getElementById('album-container');
const stickerBar = document.getElementById('sticker-bar');
const resetBtn = document.getElementById('reset-btn');

const originalStickers = Array.from(stickerBar.querySelectorAll('img')).map(img => img.src);

let attachedSticker = null;
let selectedSticker = null;

function createStickerWrapper(src, x, y) {
  const wrapper = document.createElement('div');
  wrapper.classList.add('sticker-wrapper');

  const img = document.createElement('img');
  img.src = src;
  wrapper.appendChild(img);

  const handle = document.createElement('div');
  handle.classList.add('resize-handle');
  handle.style.display = 'none';
  wrapper.appendChild(handle);

  wrapper.style.left = x + "px";
  wrapper.style.top = y + "px";

  // Mantener proporción original
  const ratio = img.naturalHeight / img.naturalWidth;
  let currentWidth = Math.min(150, img.naturalWidth);
  const minWidth = 50;
  const maxWidth = 300;
  img.style.width = currentWidth + "px";
  img.style.height = currentWidth * ratio + "px";

  // Selección
  wrapper.addEventListener('click', e => {
    e.stopPropagation();
    if (selectedSticker && selectedSticker !== wrapper) {
      selectedSticker.querySelector('.resize-handle').style.display = 'none';
    }
    selectedSticker = wrapper;
    handle.style.display = 'block';
  });

  document.addEventListener('click', () => {
    if (selectedSticker) {
      selectedSticker.querySelector('.resize-handle').style.display = 'none';
      selectedSticker = null;
    }
  });

  // Mover sticker
  wrapper.addEventListener('mousedown', e => {
    if (e.target === handle) return;
    e.preventDefault();
    const rect = albumContainer.getBoundingClientRect();
    const shiftX = e.clientX - wrapper.getBoundingClientRect().left;
    const shiftY = e.clientY - wrapper.getBoundingClientRect().top;

    function moveAt(pageX, pageY) {
      wrapper.style.left = pageX - rect.left - shiftX + 'px';
      wrapper.style.top = pageY - rect.top - shiftY + 'px';
    }

    function onMouseMove(ev) { moveAt(ev.clientX, ev.clientY); }
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', () => {
      document.removeEventListener('mousemove', onMouseMove);
    }, { once: true });
  });

  // Resize seguro
  handle.addEventListener('mousedown', e => {
    e.stopPropagation();
    e.preventDefault();
    const startX = e.clientX;
    const startWidth = currentWidth;

    function onMouseMove(ev) {
      let newWidth = startWidth + (ev.clientX - startX);
      newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
      currentWidth = newWidth;
      img.style.width = newWidth + "px";
      img.style.height = newWidth * ratio + "px"; // ⚡ proporción
    }

    function onMouseUp() {
      document.removeEventListener('mousemove', onMouseMove);
      document.removeEventListener('mouseup', onMouseUp);
    }

    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  });

  albumContainer.appendChild(wrapper);
}

// Stickers "attached" al cursor
stickerBar.querySelectorAll('img').forEach(sticker => {
  sticker.addEventListener('mousedown', function(e) {
    e.preventDefault();
    attachedSticker = document.createElement('img');
    attachedSticker.src = sticker.src;
    attachedSticker.style.position = 'absolute';
    attachedSticker.style.pointerEvents = 'none';
    attachedSticker.style.width = sticker.width + "px";
    attachedSticker.style.height = sticker.height + "px";
    attachedSticker.dataset.src = sticker.src;
    document.body.appendChild(attachedSticker);

    function moveAttached(ev) {
      attachedSticker.style.left = ev.clientX - attachedSticker.width/2 + "px";
      attachedSticker.style.top = ev.clientY - attachedSticker.height/2 + "px";
    }
    moveAttached(e);

    document.addEventListener('mousemove', moveAttached);

    document.addEventListener('mouseup', function upHandler(ev) {
      document.removeEventListener('mousemove', moveAttached);
      document.removeEventListener('mouseup', upHandler);

      const rect = albumContainer.getBoundingClientRect();
      if (
        ev.clientX >= rect.left && ev.clientX <= rect.right &&
        ev.clientY >= rect.top && ev.clientY <= rect.bottom
      ) {
        createStickerWrapper(attachedSticker.dataset.src,
                             ev.clientX - rect.left - attachedSticker.width/2,
                             ev.clientY - rect.top - attachedSticker.height/2);
        sticker.remove();
      }
      attachedSticker.remove();
      attachedSticker = null;
    });
  });
});

// Reset
resetBtn.addEventListener('click', () => {
  const placed = albumContainer.querySelectorAll('.sticker-wrapper');
  placed.forEach(s => s.remove());

  stickerBar.innerHTML = '';
  originalStickers.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    stickerBar.appendChild(img);
  });
});
</script>
</body>
</html>
